!function(e){"use strict";"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?module.exports=e:"function"==typeof define?define.amd||define(["jquery"],e):window.editormd=e()}(function(){"use strict";var v="undefined"==typeof jQuery?Zepto:jQuery;if("undefined"!=typeof v){var j=function(o,t){return new j.fn.init(o,t)};j.title=j.$name="Editor.md",j.version="1.5.0",j.homePage="https://pandao.github.io/editor.md/",j.classPrefix="editormd-",j.toolbarModes={full:["undo","redo","|","bold","del","italic","quote","ucwords","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","link","reference-link","image","code","preformatted-text","code-block","table","datetime","emoji","html-entities","pagebreak","|","goto-line","watch","preview","fullscreen","clear","search","|","help","info"],simple:["undo","redo","|","bold","del","italic","quote","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","watch","preview","fullscreen","|","help","info"],mini:["undo","redo","|","watch","preview","|","help","info"]},j.defaults={mode:"gfm",name:"",value:"",theme:"",editorTheme:"default",previewTheme:"",markdown:"",appendMarkdown:"",width:"100%",height:"100%",path:"./lib/",pluginPath:"",delay:300,autoLoadModules:!0,watch:!0,placeholder:"Enjoy Markdown! coding now...",gotoLine:!0,codeFold:!1,autoHeight:!1,autoFocus:!0,autoCloseTags:!0,searchReplace:!0,syncScrolling:!0,readOnly:!1,tabSize:4,indentUnit:4,lineNumbers:!0,lineWrapping:!0,autoCloseBrackets:!0,showTrailingSpace:!0,matchBrackets:!0,indentWithTabs:!0,styleSelectedText:!0,matchWordHighlight:!0,styleActiveLine:!0,dialogLockScreen:!0,dialogShowMask:!0,dialogDraggable:!0,dialogMaskBgColor:"#fff",dialogMaskOpacity:.1,fontSize:"13px",saveHTMLToTextarea:!1,disabledKeyMaps:[],onload:function(){},onresize:function(){},onchange:function(){},onwatch:null,onunwatch:null,onpreviewing:function(){},onpreviewed:function(){},onfullscreen:function(){},onfullscreenExit:function(){},onscroll:function(){},onpreviewscroll:function(){},imageUpload:!1,imageFormats:["jpg","jpeg","gif","png","bmp","webp"],imageUploadURL:"",crossDomainUpload:!1,uploadCallbackURL:"",toc:!0,tocm:!1,tocTitle:"",tocDropdown:!1,tocContainer:"",tocStartLevel:1,htmlDecode:!1,pageBreak:!0,atLink:!0,emailLink:!0,taskList:!1,emoji:!1,tex:!1,flowChart:!1,sequenceDiagram:!1,previewCodeHighlight:!0,toolbar:!0,toolbarAutoFixed:!0,toolbarIcons:"full",toolbarTitles:{},toolbarHandlers:{ucwords:function(){return j.toolbarHandlers.ucwords},lowercase:function(){return j.toolbarHandlers.lowercase}},toolbarCustomIcons:{lowercase:"<a href=\"javascript:;\" title=\"Lowercase\" unselectable=\"on\"><i class=\"fa\" name=\"lowercase\" style=\"font-size:24px;margin-top: -10px;\">a</i></a>",ucwords:"<a href=\"javascript:;\" title=\"ucwords\" unselectable=\"on\"><i class=\"fa\" name=\"ucwords\" style=\"font-size:20px;margin-top: -3px;\">Aa</i></a>"},toolbarIconsClass:{undo:"fa-undo",redo:"fa-repeat",bold:"fa-bold",del:"fa-strikethrough",italic:"fa-italic",quote:"fa-quote-left",uppercase:"fa-font",h1:j.classPrefix+"bold",h2:j.classPrefix+"bold",h3:j.classPrefix+"bold",h4:j.classPrefix+"bold",h5:j.classPrefix+"bold",h6:j.classPrefix+"bold","list-ul":"fa-list-ul","list-ol":"fa-list-ol",hr:"fa-minus",link:"fa-link","reference-link":"fa-anchor",image:"fa-picture-o",code:"fa-code","preformatted-text":"fa-file-code-o","code-block":"fa-file-code-o",table:"fa-table",datetime:"fa-clock-o",emoji:"fa-smile-o","html-entities":"fa-copyright",pagebreak:"fa-newspaper-o","goto-line":"fa-terminal",watch:"fa-eye-slash",unwatch:"fa-eye",preview:"fa-desktop",search:"fa-search",fullscreen:"fa-arrows-alt",clear:"fa-eraser",help:"fa-question-circle",info:"fa-info-circle"},toolbarIconTexts:{},lang:{name:"zh-cn",description:"\u5F00\u6E90\u5728\u7EBFMarkdown\u7F16\u8F91\u5668<br/>Open source online Markdown editor.",tocTitle:"\u76EE\u5F55",toolbar:{undo:"\u64A4\u9500\uFF08Ctrl+Z\uFF09",redo:"\u91CD\u505A\uFF08Ctrl+Y\uFF09",bold:"\u7C97\u4F53",del:"\u5220\u9664\u7EBF",italic:"\u659C\u4F53",quote:"\u5F15\u7528",ucwords:"\u5C06\u6BCF\u4E2A\u5355\u8BCD\u9996\u5B57\u6BCD\u8F6C\u6210\u5927\u5199",uppercase:"\u5C06\u6240\u9009\u8F6C\u6362\u6210\u5927\u5199",lowercase:"\u5C06\u6240\u9009\u8F6C\u6362\u6210\u5C0F\u5199",h1:"\u6807\u98981",h2:"\u6807\u98982",h3:"\u6807\u98983",h4:"\u6807\u98984",h5:"\u6807\u98985",h6:"\u6807\u98986","list-ul":"\u65E0\u5E8F\u5217\u8868","list-ol":"\u6709\u5E8F\u5217\u8868",hr:"\u6A2A\u7EBF",link:"\u94FE\u63A5","reference-link":"\u5F15\u7528\u94FE\u63A5",image:"\u6DFB\u52A0\u56FE\u7247",code:"\u884C\u5185\u4EE3\u7801","preformatted-text":"\u9884\u683C\u5F0F\u6587\u672C / \u4EE3\u7801\u5757\uFF08\u7F29\u8FDB\u98CE\u683C\uFF09","code-block":"\u4EE3\u7801\u5757\uFF08\u591A\u8BED\u8A00\u98CE\u683C\uFF09",table:"\u6DFB\u52A0\u8868\u683C",datetime:"\u65E5\u671F\u65F6\u95F4",emoji:"Emoji\u8868\u60C5","html-entities":"HTML\u5B9E\u4F53\u5B57\u7B26",pagebreak:"\u63D2\u5165\u5206\u9875\u7B26","goto-line":"\u8DF3\u8F6C\u5230\u884C",watch:"\u5173\u95ED\u5B9E\u65F6\u9884\u89C8",unwatch:"\u5F00\u542F\u5B9E\u65F6\u9884\u89C8",preview:"\u5168\u7A97\u53E3\u9884\u89C8HTML\uFF08\u6309 Shift + ESC\u8FD8\u539F\uFF09",fullscreen:"\u5168\u5C4F\uFF08\u6309ESC\u8FD8\u539F\uFF09",clear:"\u6E05\u7A7A",search:"\u641C\u7D22",help:"\u4F7F\u7528\u5E2E\u52A9",info:"\u5173\u4E8E"+j.title},buttons:{enter:"\u786E\u5B9A",cancel:"\u53D6\u6D88",close:"\u5173\u95ED"},dialog:{link:{title:"\u6DFB\u52A0\u94FE\u63A5",url:"\u94FE\u63A5\u5730\u5740",urlTitle:"\u94FE\u63A5\u6807\u9898",urlEmpty:"\u9519\u8BEF\uFF1A\u8BF7\u586B\u5199\u94FE\u63A5\u5730\u5740\u3002"},referenceLink:{title:"\u6DFB\u52A0\u5F15\u7528\u94FE\u63A5",name:"\u5F15\u7528\u540D\u79F0",url:"\u94FE\u63A5\u5730\u5740",urlId:"\u94FE\u63A5ID",urlTitle:"\u94FE\u63A5\u6807\u9898",nameEmpty:"\u9519\u8BEF\uFF1A\u5F15\u7528\u94FE\u63A5\u7684\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\u3002",idEmpty:"\u9519\u8BEF\uFF1A\u8BF7\u586B\u5199\u5F15\u7528\u94FE\u63A5\u7684ID\u3002",urlEmpty:"\u9519\u8BEF\uFF1A\u8BF7\u586B\u5199\u5F15\u7528\u94FE\u63A5\u7684URL\u5730\u5740\u3002"},image:{title:"\u6DFB\u52A0\u56FE\u7247",url:"\u56FE\u7247\u5730\u5740",link:"\u56FE\u7247\u94FE\u63A5",alt:"\u56FE\u7247\u63CF\u8FF0",uploadButton:"\u672C\u5730\u4E0A\u4F20",imageURLEmpty:"\u9519\u8BEF\uFF1A\u56FE\u7247\u5730\u5740\u4E0D\u80FD\u4E3A\u7A7A\u3002",uploadFileEmpty:"\u9519\u8BEF\uFF1A\u4E0A\u4F20\u7684\u56FE\u7247\u4E0D\u80FD\u4E3A\u7A7A\u3002",formatNotAllowed:"\u9519\u8BEF\uFF1A\u53EA\u5141\u8BB8\u4E0A\u4F20\u56FE\u7247\u6587\u4EF6\uFF0C\u5141\u8BB8\u4E0A\u4F20\u7684\u56FE\u7247\u6587\u4EF6\u683C\u5F0F\u6709\uFF1A"},preformattedText:{title:"\u6DFB\u52A0\u9884\u683C\u5F0F\u6587\u672C\u6216\u4EE3\u7801\u5757",emptyAlert:"\u9519\u8BEF\uFF1A\u8BF7\u586B\u5199\u9884\u683C\u5F0F\u6587\u672C\u6216\u4EE3\u7801\u7684\u5185\u5BB9\u3002"},codeBlock:{title:"\u6DFB\u52A0\u4EE3\u7801\u5757",selectLabel:"\u4EE3\u7801\u8BED\u8A00\uFF1A",selectDefaultText:"\u8BF7\u9009\u62E9\u4EE3\u7801\u8BED\u8A00",otherLanguage:"\u5176\u4ED6\u8BED\u8A00",unselectedLanguageAlert:"\u9519\u8BEF\uFF1A\u8BF7\u9009\u62E9\u4EE3\u7801\u6240\u5C5E\u7684\u8BED\u8A00\u7C7B\u578B\u3002",codeEmptyAlert:"\u9519\u8BEF\uFF1A\u8BF7\u586B\u5199\u4EE3\u7801\u5185\u5BB9\u3002"},htmlEntities:{title:"HTML \u5B9E\u4F53\u5B57\u7B26"},help:{title:"\u4F7F\u7528\u5E2E\u52A9"}}}},j.classNames={tex:j.classPrefix+"tex"},j.dialogZindex=99999,j.$katex=null,j.$marked=null,j.$CodeMirror=null,j.$prettyPrint=null;var g,a;j.prototype=j.fn={state:{watching:!1,loaded:!1,preview:!1,fullscreen:!1},init:function(o,i){i=i||{},"object"==typeof o&&(i=o);var l=this.classPrefix=j.classPrefix,d=this.settings=v.extend(!0,j.defaults,i);o="object"==typeof o?d.id:o;var r=this.editor=v("#"+o);this.id=o,this.lang=d.lang;var n=this.classNames={textarea:{html:l+"html-textarea",markdown:l+"markdown-textarea"}};d.pluginPath=""===d.pluginPath?d.path+"../plugins/":d.pluginPath,this.state.watching=!!d.watch,r.hasClass("editormd")||r.addClass("editormd"),r.css({width:"number"==typeof d.width?d.width+"px":d.width,height:"number"==typeof d.height?d.height+"px":d.height}),d.autoHeight&&r.css("height","auto");var a=this.markdownTextarea=r.children("textarea");1>a.length&&(r.append("<textarea></textarea>"),a=this.markdownTextarea=r.children("textarea")),a.addClass(n.textarea.markdown).attr("placeholder",d.placeholder),("undefined"==typeof a.attr("name")||""===a.attr("name"))&&a.attr("name",""===d.name?o+"-markdown-doc":d.name);var c=[d.readOnly?"":"<a href=\"javascript:;\" class=\"fa fa-close "+l+"preview-close-btn\"></a>",d.saveHTMLToTextarea?"<textarea class=\""+n.textarea.html+"\" name=\""+o+"-html-code\"></textarea>":"","<div class=\""+l+"preview\"><div class=\"markdown-body "+l+"preview-container\"></div></div>","<div class=\""+l+"container-mask\" style=\"display:block;\"></div>","<div class=\""+l+"mask\"></div>"].join("\n");return r.append(c).addClass(l+"vertical"),""!==d.theme&&r.addClass(l+"theme-"+d.theme),this.mask=r.children("."+l+"mask"),this.containerMask=r.children("."+l+"container-mask"),""!==d.markdown&&a.val(d.markdown),""!==d.appendMarkdown&&a.val(a.val()+d.appendMarkdown),this.htmlTextarea=r.children("."+n.textarea.html),this.preview=r.children("."+l+"preview"),this.previewContainer=this.preview.children("."+l+"preview-container"),""!==d.previewTheme&&this.preview.addClass(l+"preview-theme-"+d.previewTheme),"function"==typeof define&&define.amd&&("undefined"!=typeof katex&&(j.$katex=katex),d.searchReplace&&!d.readOnly&&(j.loadCSS(d.path+"codemirror/addon/dialog/dialog"),j.loadCSS(d.path+"codemirror/addon/search/matchesonscrollbar"))),"function"==typeof define&&define.amd||!d.autoLoadModules?("undefined"!=typeof CodeMirror&&(j.$CodeMirror=CodeMirror),"undefined"!=typeof marked&&(j.$marked=marked),this.setCodeMirror().setToolbar().loadedDisplay()):this.loadQueues(),this},loadQueues:function(){var a=this,t=this.settings,e=t.path,i=function(){return j.isIE8?void a.loadedDisplay():void(t.flowChart||t.sequenceDiagram?j.loadScript(e+"raphael.min",function(){j.loadScript(e+"underscore.min",function(){!t.flowChart&&t.sequenceDiagram?j.loadScript(e+"sequence-diagram.min",function(){a.loadedDisplay()}):t.flowChart&&!t.sequenceDiagram?j.loadScript(e+"flowchart.min",function(){j.loadScript(e+"jquery.flowchart.min",function(){a.loadedDisplay()})}):t.flowChart&&t.sequenceDiagram&&j.loadScript(e+"flowchart.min",function(){j.loadScript(e+"jquery.flowchart.min",function(){j.loadScript(e+"sequence-diagram.min",function(){a.loadedDisplay()})})})})}):a.loadedDisplay())};return j.loadCSS(e+"codemirror/codemirror.min"),t.searchReplace&&!t.readOnly&&(j.loadCSS(e+"codemirror/addon/dialog/dialog"),j.loadCSS(e+"codemirror/addon/search/matchesonscrollbar")),t.codeFold&&j.loadCSS(e+"codemirror/addon/fold/foldgutter"),j.loadScript(e+"codemirror/codemirror.min",function(){j.$CodeMirror=CodeMirror,j.loadScript(e+"codemirror/modes.min",function(){j.loadScript(e+"codemirror/addons.min",function(){return a.setCodeMirror(),"gfm"!==t.mode&&"markdown"!==t.mode?(a.loadedDisplay(),!1):(a.setToolbar(),void j.loadScript(e+"marked.min",function(){j.$marked=marked,t.previewCodeHighlight?j.loadScript(e+"prettify.min",function(){i()}):i()}))})})}),this},setTheme:function(o){var a=this.editor,e=this.settings.theme,t=this.classPrefix+"theme-";return a.removeClass(t+e).addClass(t+o),this.settings.theme=o,this},setEditorTheme:function(o){var t=this.settings;return t.editorTheme=o,"default"!==o&&j.loadCSS(t.path+"codemirror/theme/"+t.editorTheme),this.cm.setOption("theme",o),this},setCodeMirrorTheme:function(e){return this.setEditorTheme(e),this},setPreviewTheme:function(o){var a=this.preview,e=this.settings.previewTheme,t=this.classPrefix+"preview-theme-";return a.removeClass(t+e).addClass(t+o),this.settings.previewTheme=o,this},setCodeMirror:function(){var o=this.settings,t=this.editor;"default"!==o.editorTheme&&j.loadCSS(o.path+"codemirror/theme/"+o.editorTheme);var e={mode:o.mode,theme:o.editorTheme,tabSize:o.tabSize,dragDrop:!1,autofocus:o.autoFocus,autoCloseTags:o.autoCloseTags,readOnly:!!o.readOnly&&"nocursor",indentUnit:o.indentUnit,lineNumbers:o.lineNumbers,lineWrapping:o.lineWrapping,extraKeys:{"Ctrl-Q":function(e){e.foldCode(e.getCursor())}},foldGutter:o.codeFold,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],matchBrackets:o.matchBrackets,indentWithTabs:o.indentWithTabs,styleActiveLine:o.styleActiveLine,styleSelectedText:o.styleSelectedText,autoCloseBrackets:o.autoCloseBrackets,showTrailingSpace:o.showTrailingSpace,highlightSelectionMatches:!!o.matchWordHighlight&&{showToken:"onselected"!==o.matchWordHighlight&&/\w/}};return this.codeEditor=this.cm=j.$CodeMirror.fromTextArea(this.markdownTextarea[0],e),this.codeMirror=this.cmElement=t.children(".CodeMirror"),""!==o.value&&this.cm.setValue(o.value),this.codeMirror.css({fontSize:o.fontSize,width:o.watch?"50%":"100%"}),o.autoHeight&&(this.codeMirror.css("height","auto"),this.cm.setOption("viewportMargin",1/0)),o.lineNumbers||this.codeMirror.find(".CodeMirror-gutters").css("border-right","none"),this},getCodeMirrorOption:function(e){return this.cm.getOption(e)},setCodeMirrorOption:function(t,o){return this.cm.setOption(t,o),this},addKeyMap:function(t,o){return this.cm.addKeyMap(t,o),this},removeKeyMap:function(e){return this.cm.removeKeyMap(e),this},gotoLine:function(t){var m=this.settings;if(!m.gotoLine)return this;var g=this.cm,i=(this.editor,g.lineCount()),o=this.preview;if("string"==typeof t&&("last"===t&&(t=i),"first"===t&&(t=1)),"number"!=typeof t)return alert("Error: The line number must be an integer."),this;if(t=parseInt(t)-1,t>i)return alert("Error: The line number range 1-"+i),this;g.setCursor({line:t,ch:0});var r=g.getScrollInfo(),n=r.clientHeight,a=g.charCoords({line:t,ch:0},"local");if(g.scrollTo(null,(a.top+a.bottom-n)/2),m.watch){var s=this.codeMirror.find(".CodeMirror-scroll")[0],l=v(s).height(),c=s.scrollTop,h=c/s.scrollHeight;o.scrollTop(0===c?0:c+l>=s.scrollHeight-16?o[0].scrollHeight:o[0].scrollHeight*h)}return g.focus(),this},extend:function(){return"undefined"!=typeof arguments[1]&&("function"==typeof arguments[1]&&(arguments[1]=v.proxy(arguments[1],this)),this[arguments[0]]=arguments[1]),"object"==typeof arguments[0]&&"undefined"==typeof arguments[0].length&&v.extend(!0,this,arguments[0]),this},set:function(o,e){return"undefined"!=typeof e&&"function"==typeof e&&(e=v.proxy(e,this)),this[o]=e,this},config:function(o,e){var t=this.settings;return"object"==typeof o&&(t=v.extend(!0,t,o)),"string"==typeof o&&(t[o]=e),this.settings=t,this.recreate(),this},on:function(o,e){var t=this.settings;return"undefined"!=typeof t["on"+o]&&(t["on"+o]=v.proxy(e,this)),this},off:function(t){var o=this.settings;return"undefined"!=typeof o["on"+t]&&(o["on"+t]=function(){}),this},showToolbar:function(o){var e=this.settings;return e.readOnly?this:(e.toolbar&&(1>this.toolbar.length||""===this.toolbar.find("."+this.classPrefix+"menu").html())&&this.setToolbar(),e.toolbar=!0,this.toolbar.show(),this.resize(),v.proxy(o||function(){},this)(),this)},hideToolbar:function(o){var e=this.settings;return e.toolbar=!1,this.toolbar.hide(),this.resize(),v.proxy(o||function(){},this)(),this},setToolbarAutoFixed:function(i){var e=this.state,l=this.editor,a=this.toolbar,o=this.settings;return"undefined"!=typeof i&&(o.toolbarAutoFixed=i),!e.fullscreen&&!e.preview&&o.toolbar&&o.toolbarAutoFixed&&v(window).bind("scroll",function(){var i=v(window),e=i.scrollTop();return!!o.toolbarAutoFixed&&void a.css(10<e-l.offset().top&&e<l.height()?{position:"fixed",width:l.width()+"px",left:(i.width()-l.width())/2+"px"}:{position:"absolute",width:"100%",left:0})}),this},setToolbar:function(){var r=this.settings;if(r.readOnly)return this;var t=this.editor,e=(this.preview,this.classPrefix),i=this.toolbar=t.children("."+e+"toolbar");if(r.toolbar&&1>i.length&&(t.append("<div class=\""+e+"toolbar\"><div class=\""+e+"toolbar-container\"><ul class=\""+e+"menu\"></ul></div></div>"),i=this.toolbar=t.children("."+e+"toolbar")),!r.toolbar)return i.hide(),this;i.show();for(var l,c="function"==typeof r.toolbarIcons?r.toolbarIcons():"string"==typeof r.toolbarIcons?j.toolbarModes[r.toolbarIcons]:r.toolbarIcons,h=i.find("."+this.classPrefix+"menu"),a="",g=!1,m=0,p=c.length;p>m;m++)if(l=c[m],"||"===l)g=!0;else if("|"===l)a+="<li class=\"divider\" unselectable=\"on\">|</li>";else{var u=/h(\d)/.test(l),d=l;"watch"!==l||r.watch||(d="unwatch");var w=r.lang.toolbar[d],k=r.toolbarIconTexts[d],C=r.toolbarIconsClass[d];w="undefined"==typeof w?"":w,k="undefined"==typeof k?"":k,C="undefined"==typeof C?"":C;var v=g?"<li class=\"pull-right\">":"<li>";"undefined"!=typeof r.toolbarCustomIcons[l]&&"function"!=typeof r.toolbarCustomIcons[l]?v+=r.toolbarCustomIcons[l]:(v+="<a href=\"javascript:;\" title=\""+w+"\" unselectable=\"on\">",v+="<i class=\"fa "+C+"\" name=\""+l+"\" unselectable=\"on\">"+(u?l.toUpperCase():""===C?k:"")+"</i>",v+="</a>"),v+="</li>",a=g?v+a:a+v}return h.html(a),h.find("[title=\"Lowercase\"]").attr("title",r.lang.toolbar.lowercase),h.find("[title=\"ucwords\"]").attr("title",r.lang.toolbar.ucwords),this.setToolbarHandler(),this.setToolbarAutoFixed(),this},dialogLockScreen:function(){return v.proxy(j.dialogLockScreen,this)(),this},dialogShowMask:function(t){return v.proxy(j.dialogShowMask,this)(t),this},getToolbarHandles:function(o){var t=this.toolbarHandlers=j.toolbarHandlers;return o&&"undefined"!=typeof toolbarIconHandlers[o]?t[o]:t},setToolbarHandler:function(){var s=this,e=this.settings;if(!e.toolbar||e.readOnly)return this;var t=this.toolbar,d=this.cm,o=this.classPrefix,i=this.toolbarIcons=t.find("."+o+"menu > li > a"),c=this.getToolbarHandles();return i.bind(j.mouseOrTouch("click","touchend"),function(){var t=v(this).children(".fa"),o=t.attr("name"),i=d.getCursor(),a=d.getSelection();return""===o?void 0:(s.activeIcon=t,"undefined"==typeof c[o]?"undefined"!=typeof e.toolbarHandlers[o]&&v.proxy(e.toolbarHandlers[o],s)(d,t,i,a):v.proxy(c[o],s)(d),"link"!==o&&"reference-link"!==o&&"image"!==o&&"code-block"!==o&&"preformatted-text"!==o&&"watch"!==o&&"preview"!==o&&"search"!==o&&"fullscreen"!==o&&"info"!==o&&d.focus(),!1)}),this},createDialog:function(t){return v.proxy(j.createDialog,this)(t)},createInfoDialog:function(){var r=this,t=this.editor,e=this.classPrefix,i=["<div class=\""+e+"dialog "+e+"dialog-info\" style=\"\">","<div class=\""+e+"dialog-container\">","<h1><i class=\"editormd-logo editormd-logo-lg editormd-logo-color\"></i> "+j.title+"<small>v"+j.version+"</small></h1>","<p>"+this.lang.description+"</p>","<p style=\"margin: 10px 0 20px 0;\"><a href=\""+j.homePage+"\" target=\"_blank\">"+j.homePage+" <i class=\"fa fa-external-link\"></i></a></p>","<p style=\"font-size: 0.85em;\">Copyright &copy; 2015 <a href=\"https://github.com/pandao\" target=\"_blank\" class=\"hover-link\">Pandao</a>, The <a href=\"https://github.com/pandao/editor.md/blob/master/LICENSE\" target=\"_blank\" class=\"hover-link\">MIT</a> License.</p>","</div>","<a href=\"javascript:;\" class=\"fa fa-close "+e+"dialog-close\"></a>","</div>"].join("\n");t.append(i);var o=this.infoDialog=t.children("."+e+"dialog-info");return o.find("."+e+"dialog-close").bind(j.mouseOrTouch("click","touchend"),function(){r.hideInfoDialog()}),o.css("border",j.isIE8?"1px solid #ddd":"").css("z-index",j.dialogZindex).show(),this.infoDialogPosition(),this},infoDialogPosition:function(){var o=this.infoDialog,e=function(){o.css({top:(v(window).height()-o.height())/2+"px",left:(v(window).width()-o.width())/2+"px"})};return e(),v(window).resize(e),this},showInfoDialog:function(){v("html,body").css("overflow-x","hidden");var i=this.editor,e=this.settings,t=this.infoDialog=i.children("."+this.classPrefix+"dialog-info");return 1>t.length&&this.createInfoDialog(),this.lockScreen(!0),this.mask.css({opacity:e.dialogMaskOpacity,backgroundColor:e.dialogMaskBgColor}).show(),t.css("z-index",j.dialogZindex).show(),this.infoDialogPosition(),this},hideInfoDialog:function(){return v("html,body").css("overflow-x",""),this.infoDialog.hide(),this.mask.hide(),this.lockScreen(!1),this},lockScreen:function(e){return j.lockScreen(e),this.resize(),this},recreate:function(){var t=this.editor,o=this.settings;return this.codeMirror.remove(),this.setCodeMirror(),o.readOnly||(0<t.find(".editormd-dialog").length&&t.find(".editormd-dialog").remove(),o.toolbar&&(this.getToolbarHandles(),this.setToolbar())),this.loadedDisplay(!0),this},previewCodeHighlight:function(){var t=this.settings,o=this.previewContainer;return t.previewCodeHighlight&&(o.find("pre").addClass("prettyprint linenums"),"undefined"!=typeof prettyPrint&&prettyPrint()),this},katexRender:function(){return null===g?this:(this.previewContainer.find("."+j.classNames.tex).each(function(){var t=v(this);j.$katex.render(t.text(),t[0]),t.find(".katex").css("font-size","1.6em")}),this)},flowChartAndSequenceDiagramRender:function(){var e=this,t=this.settings,o=this.previewContainer;if(j.isIE8)return this;if(t.flowChart){if(null===a)return this;o.find(".flowchart").flowChart()}t.sequenceDiagram&&o.find(".sequence-diagram").sequenceDiagram({theme:"simple"});var i=e.preview,r=e.codeMirror,g=r.find(".CodeMirror-scroll"),n=g.height(),l=g.scrollTop(),s=l/g[0].scrollHeight,c=0;i.find(".markdown-toc-list").each(function(){c+=v(this).height()});var m=i.find(".editormd-toc-menu").height();return m=m?m:0,i.scrollTop(0===l?0:l+n>=g[0].scrollHeight-16?i[0].scrollHeight:(i[0].scrollHeight+c+m)*s),this},registerKeyMaps:function(i){var g=this,c=this.cm,t=this.settings,o=j.toolbarHandlers,r=t.disabledKeyMaps;if(i=i||null)for(var a in i)0>v.inArray(a,r)&&({}[a]=i[a],c.addKeyMap(i));else{for(var n in j.keyMaps){var l=j.keyMaps[n],s="string"==typeof l?v.proxy(o[l],g):v.proxy(l,g);if(0>v.inArray(n,["F9","F10","F11"])&&0>v.inArray(n,r)){var d={};d[n]=s,c.addKeyMap(d)}}v(window).keydown(function(t){if(0>v.inArray({120:"F9",121:"F10",122:"F11"}[t.keyCode],r))switch(t.keyCode){case 120:return v.proxy(o.watch,g)(),!1;case 121:return v.proxy(o.preview,g)(),!1;case 122:return v.proxy(o.fullscreen,g)(),!1;}})}return this},bindScrollEvent:function(){var c=this,e=this.preview,h=this.settings,s=this.codeMirror,i=j.mouseOrTouch;if(!h.syncScrolling)return this;var t=function(){s.find(".CodeMirror-scroll").bind(i("scroll","touchmove"),function(i){var o=v(this).height(),t=v(this).scrollTop(),r=t/v(this)[0].scrollHeight,a=0;e.find(".markdown-toc-list").each(function(){a+=v(this).height()});var l=e.find(".editormd-toc-menu").height();l=l?l:0,e.scrollTop(0===t?0:t+o>=v(this)[0].scrollHeight-16?e[0].scrollHeight:(e[0].scrollHeight+a+l)*r),v.proxy(h.onscroll,c)(i)})},o=function(){s.find(".CodeMirror-scroll").unbind(i("scroll","touchmove"))},a=function(){e.bind(i("scroll","touchmove"),function(e){var i=v(this).height(),t=v(this).scrollTop(),o=t/v(this)[0].scrollHeight,a=s.find(".CodeMirror-scroll");a.scrollTop(0===t?0:t+i>=v(this)[0].scrollHeight?a[0].scrollHeight:a[0].scrollHeight*o),v.proxy(h.onpreviewscroll,c)(e)})},r=function(){e.unbind(i("scroll","touchmove"))};return s.bind({mouseover:t,mouseout:o,touchstart:t,touchend:o}),"single"===h.syncScrolling?this:(e.bind({mouseover:a,mouseout:r,touchstart:a,touchend:r}),this)},bindChangeEvent:function(){var o=this,i=this.cm,e=this.settings;return e.syncScrolling?(i.on("change",function(){e.watch&&o.previewContainer.css("padding",e.autoHeight?"20px 20px 50px 40px":"20px"),g=setTimeout(function(){clearTimeout(g),o.save(),g=null},e.delay)}),this):this},loadedDisplay:function(t){t=t||!1;var l=this,a=this.editor,i=this.preview,o=this.settings;return this.containerMask.hide(),this.save(),o.watch&&i.show(),a.data("oldWidth",a.width()).data("oldHeight",a.height()),this.resize(),this.registerKeyMaps(),v(window).resize(function(){l.resize()}),this.bindScrollEvent().bindChangeEvent(),t||v.proxy(o.onload,this)(),this.state.loaded=!0,this},width:function(e){return this.editor.css("width","number"==typeof e?e+"px":e),this.resize(),this},height:function(e){return this.editor.css("height","number"==typeof e?e+"px":e),this.resize(),this},resize:function(t,i){t=t||null,i=i||null;var c=this.state,h=this.editor,o=this.preview,r=this.toolbar,n=this.settings,a=this.codeMirror;if(t&&h.css("width","number"==typeof t?t+"px":t),!n.autoHeight||c.fullscreen||c.preview?(i&&h.css("height","number"==typeof i?i+"px":i),c.fullscreen&&h.height(v(window).height()),n.toolbar&&!n.readOnly?a.css("margin-top",r.height()+1).height(h.height()-r.height()):a.css("margin-top",0).height(h.height())):(h.css("height","auto"),a.css("height","auto")),!n.watch)a.width(h.width()),o.hide();else if(a.width(h.width()/2),o.width(c.preview?h.width():h.width()/2),this.previewContainer.css("padding",n.autoHeight?"20px 20px 50px 40px":"20px"),n.toolbar&&!n.readOnly?o.css("top",r.height()+1):o.css("top",0),!n.autoHeight||c.fullscreen||c.preview){var s=n.toolbar&&!n.readOnly?h.height()-r.height():h.height();o.height(s)}else o.height("");return c.loaded&&v.proxy(n.onresize,this)(),this},save:function(){if(null===g)return this;var e=this,t=this.state,o=this.settings,i=this.cm,m=i.getValue(),r=this.previewContainer;if("gfm"!==o.mode&&"markdown"!==o.mode)return this.markdownTextarea.val(m),this;var l=j.$marked,n=this.markdownToC=[],s=this.markedRendererOptions={toc:o.toc,tocm:o.tocm,tocStartLevel:o.tocStartLevel,pageBreak:o.pageBreak,taskList:o.taskList,emoji:o.emoji,tex:o.tex,atLink:o.atLink,emailLink:o.emailLink,flowChart:o.flowChart,sequenceDiagram:o.sequenceDiagram,previewCodeHighlight:o.previewCodeHighlight},d=this.markedOptions={renderer:j.markedRenderer(n,s),gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!o.htmlDecode,smartLists:!0,smartypants:!0};l.setOptions(d);var c=j.$marked(m,d);if(c=j.filterHTMLTags(c,o.htmlDecode),this.markdownTextarea.text(m),i.save(),o.saveHTMLToTextarea&&this.htmlTextarea.text(c),o.watch||!o.watch&&t.preview){if(r.html(c),this.previewCodeHighlight(),o.toc){var f=""===o.tocContainer?r:v(o.tocContainer),u=f.find("."+this.classPrefix+"toc-menu");f.attr("previewContainer",""===o.tocContainer?"true":"false"),""!==o.tocContainer&&0<u.length&&u.remove(),j.markdownToCRenderer(n,f,o.tocDropdown,o.tocStartLevel),(o.tocDropdown||0<f.find("."+this.classPrefix+"toc-menu").length)&&j.tocDropdownMenu(f,""===o.tocTitle?this.lang.tocTitle:o.tocTitle),""!==o.tocContainer&&r.find(".markdown-toc").css("border","none")}o.tex&&(!j.kaTeXLoaded&&o.autoLoadModules?j.loadKaTeX(function(){j.$katex=katex,j.kaTeXLoaded=!0,e.katexRender()}):(j.$katex=katex,this.katexRender())),(o.flowChart||o.sequenceDiagram)&&(a=setTimeout(function(){clearTimeout(a),e.flowChartAndSequenceDiagramRender(),a=null},10)),t.loaded&&v.proxy(o.onchange,this)()}return this},focus:function(){return this.cm.focus(),this},setCursor:function(e){return this.cm.setCursor(e),this},getCursor:function(){return this.cm.getCursor()},setSelection:function(t,o){return this.cm.setSelection(t,o),this},getSelection:function(){return this.cm.getSelection()},setSelections:function(e){return this.cm.setSelections(e),this},getSelections:function(){return this.cm.getSelections()},replaceSelection:function(e){return this.cm.replaceSelection(e),this},insertValue:function(e){return this.replaceSelection(e),this},appendMarkdown:function(t){var o=(this.settings,this.cm);return o.setValue(o.getValue()+t),this},setMarkdown:function(e){return this.cm.setValue(e||this.settings.markdown),this},getMarkdown:function(){return this.cm.getValue()},getValue:function(){return this.cm.getValue()},setValue:function(e){return this.cm.setValue(e),this},clear:function(){return this.cm.setValue(""),this},getHTML:function(){return this.settings.saveHTMLToTextarea?this.htmlTextarea.val():(alert("Error: settings.saveHTMLToTextarea == false"),!1)},getTextareaSavedHTML:function(){return this.getHTML()},getPreviewedHTML:function(){return this.settings.watch?this.previewContainer.html():(alert("Error: settings.watch == false"),!1)},watch:function(a){var e=this.settings;if(0>v.inArray(e.mode,["gfm","markdown"]))return this;if(this.state.watching=e.watch=!0,this.preview.show(),this.toolbar){var t=e.toolbarIconsClass.watch,o=e.toolbarIconsClass.unwatch,i=this.toolbar.find(".fa[name=watch]");i.parent().attr("title",e.lang.toolbar.watch),i.removeClass(o).addClass(t)}return this.codeMirror.css("border-right","1px solid #ddd").width(this.editor.width()/2),g=0,this.save().resize(),e.onwatch||(e.onwatch=a||function(){}),v.proxy(e.onwatch,this)(),this},unwatch:function(r){var e=this.settings;if(this.state.watching=e.watch=!1,this.preview.hide(),this.toolbar){var t=e.toolbarIconsClass.watch,i=e.toolbarIconsClass.unwatch,o=this.toolbar.find(".fa[name=watch]");o.parent().attr("title",e.lang.toolbar.unwatch),o.removeClass(t).addClass(i)}return this.codeMirror.css("border-right","none").width(this.editor.width()),this.resize(),e.onunwatch||(e.onunwatch=r||function(){}),v.proxy(e.onunwatch,this)(),this},show:function(t){t=t||function(){};var i=this;return this.editor.show(0,function(){v.proxy(t,i)()}),this},hide:function(t){t=t||function(){};var i=this;return this.editor.hide(0,function(){v.proxy(t,i)()}),this},previewing:function(){var s=this,t=this.editor,e=this.preview,o=this.toolbar,i=this.settings,r=this.codeMirror,a=this.previewContainer;if(0>v.inArray(i.mode,["gfm","markdown"]))return this;i.toolbar&&o&&(o.toggle(),o.find(".fa[name=preview]").toggleClass("active")),r.toggle();var n=function(e){e.shiftKey&&27===e.keyCode&&s.previewed()};"none"===r.css("display")?(this.state.preview=!0,this.state.fullscreen&&e.css("background","#fff"),t.find("."+this.classPrefix+"preview-close-btn").show().bind(j.mouseOrTouch("click","touchend"),function(){s.previewed()}),i.watch?a.css("padding",""):this.save(),a.addClass(this.classPrefix+"preview-active"),e.show().css({position:"",top:0,width:t.width(),height:i.autoHeight&&!this.state.fullscreen?"auto":t.height()}),this.state.loaded&&v.proxy(i.onpreviewing,this)(),v(window).bind("keyup",n)):(v(window).unbind("keyup",n),this.previewed())},previewed:function(){var l=this.editor,e=this.preview,t=this.toolbar,o=this.settings,i=this.previewContainer,r=l.find("."+this.classPrefix+"preview-close-btn");return this.state.preview=!1,this.codeMirror.show(),o.toolbar&&t.show(),e[o.watch?"show":"hide"](),r.hide().unbind(j.mouseOrTouch("click","touchend")),i.removeClass(this.classPrefix+"preview-active"),o.watch&&i.css("padding","20px"),e.css({background:null,position:"absolute",width:l.width()/2,height:o.autoHeight&&!this.state.fullscreen?"auto":l.height()-t.height(),top:o.toolbar?t.height():0}),this.state.loaded&&v.proxy(o.onpreviewed,this)(),this},fullscreen:function(){var n=this,l=this.state,t=this.editor,e=(this.preview,this.toolbar),o=this.settings,i=this.classPrefix+"fullscreen";e&&e.find(".fa[name=fullscreen]").parent().toggleClass("active");var r=function(e){e.shiftKey||27!==e.keyCode||l.fullscreen&&n.fullscreenExit()};return t.hasClass(i)?(v(window).unbind("keyup",r),this.fullscreenExit()):(l.fullscreen=!0,v("html,body").css("overflow","hidden"),t.css({width:v(window).width(),height:v(window).height()}).addClass(i),this.resize(),v.proxy(o.onfullscreen,this)(),v(window).bind("keyup",r)),this},fullscreenExit:function(){var a=this.editor,e=this.settings,t=this.toolbar,i=this.classPrefix+"fullscreen";return this.state.fullscreen=!1,t&&t.find(".fa[name=fullscreen]").parent().removeClass("active"),v("html,body").css("overflow",""),a.css({width:a.data("oldWidth"),height:a.data("oldHeight")}).removeClass(i),this.resize(),v.proxy(e.onfullscreenExit,this)(),this},executePlugin:function(o,e){var a=this,i=this.cm,r=this.settings;return e=r.pluginPath+e,"function"==typeof define?"undefined"==typeof this[o]?(alert("Error: "+o+" plugin is not found, you are not load this plugin."),this):(this[o](i),this):(0>v.inArray(e,j.loadFiles.plugin)?j.loadPlugin(e,function(){j.loadPlugins[o]=a[o],a[o](i)}):v.proxy(j.loadPlugins[o],this)(i),this)},search:function(t){var o=this.settings;return o.searchReplace?(o.readOnly||this.cm.execCommand(t||"find"),this):(alert("Error: settings.searchReplace == false"),this)},searchReplace:function(){return this.search("replace"),this},searchReplaceAll:function(){return this.search("replaceAll"),this}},j.fn.init.prototype=j.fn,j.dialogLockScreen=function(){var t=this.settings||{dialogLockScreen:!0};t.dialogLockScreen&&(v("html,body").css("overflow","hidden"),this.resize())},j.dialogShowMask=function(o){var e=this.editor,t=this.settings||{dialogShowMask:!0};o.css({top:(v(window).height()-o.height())/2+"px",left:(v(window).width()-o.width())/2+"px"}),t.dialogShowMask&&e.children("."+this.classPrefix+"mask").css("z-index",parseInt(o.css("z-index"))-1).show()},j.toolbarHandlers={undo:function(){this.cm.undo()},redo:function(){this.cm.redo()},bold:function(){var i=this.cm,o=i.getCursor(),e=i.getSelection();i.replaceSelection("**"+e+"**"),""===e&&i.setCursor(o.line,o.ch+2)},del:function(){var i=this.cm,o=i.getCursor(),e=i.getSelection();i.replaceSelection("~~"+e+"~~"),""===e&&i.setCursor(o.line,o.ch+2)},italic:function(){var i=this.cm,o=i.getCursor(),e=i.getSelection();i.replaceSelection("*"+e+"*"),""===e&&i.setCursor(o.line,o.ch+1)},quote:function(){var i=this.cm,o=i.getCursor(),e=i.getSelection();0===o.ch?i.replaceSelection("> "+e):(i.setCursor(o.line,0),i.replaceSelection("> "+e),i.setCursor(o.line,o.ch+2))},ucfirst:function(){var o=this.cm,t=o.getSelection(),e=o.listSelections();o.replaceSelection(j.firstUpperCase(t)),o.setSelections(e)},ucwords:function(){var o=this.cm,t=o.getSelection(),e=o.listSelections();o.replaceSelection(j.wordsFirstUpperCase(t)),o.setSelections(e)},uppercase:function(){var i=this.cm,o=i.getSelection(),e=i.listSelections();i.replaceSelection(o.toUpperCase()),i.setSelections(e)},lowercase:function(){var i=this.cm,o=(i.getCursor(),i.getSelection()),e=i.listSelections();i.replaceSelection(o.toLowerCase()),i.setSelections(e)},h1:function(){var i=this.cm,o=i.getCursor(),e=i.getSelection();0===o.ch?i.replaceSelection("# "+e):(i.setCursor(o.line,0),i.replaceSelection("# "+e),i.setCursor(o.line,o.ch+2))},h2:function(){var i=this.cm,o=i.getCursor(),e=i.getSelection();0===o.ch?i.replaceSelection("## "+e):(i.setCursor(o.line,0),i.replaceSelection("## "+e),i.setCursor(o.line,o.ch+3))},h3:function(){var i=this.cm,o=i.getCursor(),e=i.getSelection();0===o.ch?i.replaceSelection("### "+e):(i.setCursor(o.line,0),i.replaceSelection("### "+e),i.setCursor(o.line,o.ch+4))},h4:function(){var i=this.cm,o=i.getCursor(),e=i.getSelection();0===o.ch?i.replaceSelection("#### "+e):(i.setCursor(o.line,0),i.replaceSelection("#### "+e),i.setCursor(o.line,o.ch+5))},h5:function(){var i=this.cm,o=i.getCursor(),e=i.getSelection();0===o.ch?i.replaceSelection("##### "+e):(i.setCursor(o.line,0),i.replaceSelection("##### "+e),i.setCursor(o.line,o.ch+6))},h6:function(){var i=this.cm,o=i.getCursor(),e=i.getSelection();0===o.ch?i.replaceSelection("###### "+e):(i.setCursor(o.line,0),i.replaceSelection("###### "+e),i.setCursor(o.line,o.ch+7))},"list-ul":function(){var o=this.cm,a=(o.getCursor(),o.getSelection());if(""===a)o.replaceSelection("- "+a);else{for(var e=a.split("\n"),t=0,r=e.length;r>t;t++)e[t]=""===e[t]?"":"- "+e[t];o.replaceSelection(e.join("\n"))}},"list-ol":function(){var o=this.cm,a=(o.getCursor(),o.getSelection());if(""===a)o.replaceSelection("1. "+a);else{for(var e=a.split("\n"),t=0,r=e.length;r>t;t++)e[t]=""===e[t]?"":t+1+". "+e[t];o.replaceSelection(e.join("\n"))}},hr:function(){{var t=this.cm,o=t.getCursor();t.getSelection()}t.replaceSelection((0===o.ch?"\n":"\n\n")+"------------\n\n")},tex:function(){if(!this.settings.tex)return alert("settings.tex === false"),this;var i=this.cm,o=i.getCursor(),e=i.getSelection();i.replaceSelection("$$"+e+"$$"),""===e&&i.setCursor(o.line,o.ch+2)},link:function(){this.executePlugin("linkDialog","link-dialog/link-dialog")},"reference-link":function(){this.executePlugin("referenceLinkDialog","reference-link-dialog/reference-link-dialog")},pagebreak:function(){if(!this.settings.pageBreak)return alert("settings.pageBreak === false"),this;{var e=this.cm;e.getSelection()}e.replaceSelection("\r\n[========]\r\n")},image:function(){this.executePlugin("imageDialog","image-dialog/image-dialog")},code:function(){var i=this.cm,o=i.getCursor(),e=i.getSelection();i.replaceSelection("`"+e+"`"),""===e&&i.setCursor(o.line,o.ch+1)},"code-block":function(){this.executePlugin("codeBlockDialog","code-block-dialog/code-block-dialog")},"preformatted-text":function(){this.executePlugin("preformattedTextDialog","preformatted-text-dialog/preformatted-text-dialog")},table:function(){this.executePlugin("tableDialog","table-dialog/table-dialog")},datetime:function(){var o=this.cm,t=(o.getSelection(),new Date,this.settings.lang.name),e=j.dateFormat()+" "+j.dateFormat("zh-cn"===t||"zh-tw"===t?"cn-week-day":"week-day");o.replaceSelection(e)},emoji:function(){this.executePlugin("emojiDialog","emoji-dialog/emoji-dialog")},"html-entities":function(){this.executePlugin("htmlEntitiesDialog","html-entities-dialog/html-entities-dialog")},"goto-line":function(){this.executePlugin("gotoLineDialog","goto-line-dialog/goto-line-dialog")},watch:function(){this[this.settings.watch?"unwatch":"watch"]()},preview:function(){this.previewing()},fullscreen:function(){this.fullscreen()},clear:function(){this.clear()},search:function(){this.search()},help:function(){this.executePlugin("helpDialog","help-dialog/help-dialog")},info:function(){this.showInfoDialog()}},j.keyMaps={"Ctrl-1":"h1","Ctrl-2":"h2","Ctrl-3":"h3","Ctrl-4":"h4","Ctrl-5":"h5","Ctrl-6":"h6","Ctrl-B":"bold","Ctrl-D":"datetime","Ctrl-E":function(){var i=this.cm,o=i.getCursor(),e=i.getSelection();return this.settings.emoji?(i.replaceSelection(":"+e+":"),void(""===e&&i.setCursor(o.line,o.ch+1))):void alert("Error: settings.emoji == false")},"Ctrl-Alt-G":"goto-line","Ctrl-H":"hr","Ctrl-I":"italic","Ctrl-K":"code","Ctrl-L":function(){var o=this.cm,a=o.getCursor(),e=o.getSelection(),t=""===e?"":" \""+e+"\"";o.replaceSelection("["+e+"]("+t+")"),""===e&&o.setCursor(a.line,a.ch+1)},"Ctrl-U":"list-ul","Shift-Ctrl-A":function(){var i=this.cm,o=i.getCursor(),e=i.getSelection();return this.settings.atLink?(i.replaceSelection("@"+e),void(""===e&&i.setCursor(o.line,o.ch+1))):void alert("Error: settings.atLink == false")},"Shift-Ctrl-C":"code","Shift-Ctrl-Q":"quote","Shift-Ctrl-S":"del","Shift-Ctrl-K":"tex","Shift-Alt-C":function(){var i=this.cm,o=i.getCursor(),e=i.getSelection();i.replaceSelection(["```",e,"```"].join("\n")),""===e&&i.setCursor(o.line,o.ch+3)},"Shift-Ctrl-Alt-C":"code-block","Shift-Ctrl-H":"html-entities","Shift-Alt-H":"help","Shift-Ctrl-E":"emoji","Shift-Ctrl-U":"uppercase","Shift-Alt-U":"ucwords","Shift-Ctrl-Alt-U":"ucfirst","Shift-Alt-L":"lowercase","Shift-Ctrl-I":function(){var o=this.cm,a=o.getCursor(),e=o.getSelection(),t=""===e?"":" \""+e+"\"";o.replaceSelection("!["+e+"]("+t+")"),""===e&&o.setCursor(a.line,a.ch+4)},"Shift-Ctrl-Alt-I":"image","Shift-Ctrl-L":"link","Shift-Ctrl-O":"list-ol","Shift-Ctrl-P":"preformatted-text","Shift-Ctrl-T":"table","Shift-Alt-P":"pagebreak",F9:"watch",F10:"preview",F11:"fullscreen"};var l=function(e){return String.prototype.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};j.trim=l;var o=function(e){return e.toLowerCase().replace(/\b(\w)|\s(\w)/g,function(e){return e.toUpperCase()})};j.ucwords=j.wordsFirstUpperCase=o;var t=function(e){return e.toLowerCase().replace(/\b(\w)/,function(e){return e.toUpperCase()})};return j.firstUpperCase=j.ucfirst=t,j.urls={atLinkBase:"https://github.com/"},j.regexs={atLink:/@(\w+)/g,email:/(\w+)@(\w+)\.(\w+)\.?(\w+)?/g,emailLink:/(mailto:)?([\w\.\_]+)@(\w+)\.(\w+)\.?(\w+)?/g,emoji:/:([\w\+-]+):/g,emojiDatetime:/(\d{2}:\d{2}:\d{2})/g,twemoji:/:(tw-([\w]+)-?(\w+)?):/g,fontAwesome:/:(fa-([\w]+)(-(\w+)){0,}):/g,editormdLogo:/:(editormd-logo-?(\w+)?):/g,pageBreak:/^\[[=]{8,}\]$/},j.emoji={path:"http://www.emoji-cheat-sheet.com/graphics/emojis/",ext:".png"},j.twemoji={path:"http://twemoji.maxcdn.com/36x36/",ext:".png"},j.markedRenderer=function(m,i){var u=v.extend({toc:!0,tocm:!1,tocStartLevel:1,pageBreak:!0,atLink:!0,emailLink:!0,taskList:!1,emoji:!1,tex:!1,flowChart:!1,sequenceDiagram:!1},i||{}),f=j.$marked,e=new f.Renderer;m=m||[];var t=j.regexs,w=t.atLink,o=t.emoji,a=t.email,n=t.emailLink,s=t.twemoji,k=t.fontAwesome,g=t.editormdLogo,c=t.pageBreak;return e.emoji=function(e){e=e.replace(j.regexs.emojiDatetime,function(e){return e.replace(/:/g,"&#58;")});var t=e.match(o);if(!t||!u.emoji)return e;for(var r=0,l=t.length;l>r;r++)":+1:"===t[r]&&(t[r]=":\\+1:"),e=e.replace(new RegExp(t[r]),function(n){var t=n.match(k),e=n.replace(/:/g,"");if(t)for(var o,h=0,p=t.length;p>h;h++)return o=t[h].replace(/:/g,""),"<i class=\"fa "+o+" fa-emoji\" title=\""+o.replace("fa-","")+"\"></i>";else{var m=n.match(g),a=n.match(s);if(m)for(var l,u=0,f=m.length;f>u;u++)return l=m[u].replace(/:/g,""),"<i class=\""+l+"\" title=\"Editor.md logo ("+l+")\"></i>";else{if(!a){var w="+1"===e?"plus1":e;return w="black_large_square"===w?"black_square":w,w="moon"===w?"waxing_gibbous_moon":w,"<img src=\""+j.emoji.path+w+j.emoji.ext+"\" class=\"emoji\" title=\"&#58;"+e+"&#58;\" alt=\"&#58;"+e+"&#58;\" />"}for(var b,C=0,v=a.length;v>C;C++)return b=a[C].replace(/:/g,"").replace("tw-",""),"<img src=\""+j.twemoji.path+b+j.twemoji.ext+"\" title=\"twemoji-"+b+"\" alt=\"twemoji-"+b+"\" class=\"emoji twemoji\" />"}}});return e},e.atLink=function(t){return w.test(t)?(u.atLink&&(t=t.replace(a,function(e){return e.replace(/@/g,"_#_&#64;_#_")}),t=t.replace(w,function(o,t){return"<a href=\""+j.urls.atLinkBase+t+"\" title=\"&#64;"+t+"\" class=\"at-link\">"+o+"</a>"}).replace(/_#_&#64;_#_/g,"@")),u.emailLink&&(t=t.replace(n,function(r,e,t,i,o){return!e&&0>v.inArray(o,["jpg","jpeg","png","gif","webp","ico","icon","pdf"])?"<a href=\"mailto:"+r+"\">"+r+"</a>":r})),t):t},e.link=function(r,a,e){if(this.options.sanitize){try{var t=decodeURIComponent(unescape(r)).replace(/[^\w:]/g,"").toLowerCase()}catch(t){return""}if(0===t.indexOf("javascript:"))return""}var i="<a href=\""+r+"\"";return w.test(a)||w.test(e)?(a&&(i+=" title=\""+a.replace(/@/g,"&#64;")),i+"\">"+e.replace(/@/g,"&#64;")+"</a>"):(a&&(i+=" title=\""+a+"\""),i+=">"+e+"</a>")},e.heading=function(e,r){var i=e,t=/\s*\<a\s*href\=\"(.*)\"\s*([^\>]*)\>(.*)\<\/a\>\s*/;if(t.test(e)){var n=[];e=e.split(/\<a\s*([^\>]+)\>([^\>]*)\<\/a\>/);for(var a=0,g=e.length;g>a;a++)n.push(e[a].replace(/\s*href\=\"(.*)\"\s*/g,""));e=n.join(" ")}e=l(e);var p=e.toLowerCase().replace(/[^\w]+/g,"-"),c={text:e,level:r,slug:p},h=/^[\u4e00-\u9fa5]+$/.test(e),d=h?escape(e).replace(/\%/g,""):e.toLowerCase().replace(/[^\w]+/g,"-");m.push(c);var u="<h"+r+" id=\"h"+r+"-"+this.options.headerPrefix+d+"\">";return u+="<a name=\""+e+"\" class=\"reference-link\"></a>",u+="<span class=\"header-link octicon octicon-link\"></span>",u+=this.atLink(t?this.emoji(i):this.emoji(e)),u+="</h"+r+">"},e.pageBreak=function(e){return c.test(e)&&u.pageBreak&&(e="<hr style=\"page-break-after:always;\" class=\"page-break editormd-page-break\" />"),e},e.paragraph=function(e){var t=/\$\$(.*)\$\$/g.test(e),l=/^\$\$(.*)\$\$$/.test(e),i=l?" class=\""+j.classNames.tex+"\"":"",o=u.tocm?/^(\[TOC\]|\[TOCM\])$/.test(e):/^\[TOC\]$/.test(e),r=/^\[TOCM\]$/.test(e);e=!l&&t?e.replace(/(\$\$([^\$]*)\$\$)+/g,function(o,t){return"<span class=\""+j.classNames.tex+"\">"+t.replace(/\$/g,"")+"</span>"}):l?e.replace(/\$/g,""):e;var n="<div class=\"markdown-toc editormd-markdown-toc\">"+e+"</div>";return o?r?"<div class=\"editormd-toc-menu\">"+n+"</div><br/>":n:c.test(e)?this.pageBreak(e):"<p"+i+">"+this.atLink(this.emoji(e))+"</p>\n"},e.code=function(o,t){return"seq"===t||"sequence"===t?"<div class=\"sequence-diagram\">"+o+"</div>":"flow"===t?"<div class=\"flowchart\">"+o+"</div>":"math"===t||"latex"===t||"katex"===t?"<p class=\""+j.classNames.tex+"\">"+o+"</p>":f.Renderer.prototype.code.apply(this,arguments)},e.tablecell=function(o,a){var e=a.header?"th":"td",t=a.align?"<"+e+" style=\"text-align:"+a.align+"\">":"<"+e+">";return t+this.atLink(this.emoji(o))+"</"+e+">\n"},e.listitem=function(e){return u.taskList&&/^\s*\[[x\s]\]\s*/.test(e)?(e=e.replace(/^\s*\[\s\]\s*/,"<input type=\"checkbox\" class=\"task-list-item-checkbox\" /> ").replace(/^\s*\[x\]\s*/,"<input type=\"checkbox\" class=\"task-list-item-checkbox\" checked disabled /> "),"<li style=\"list-style: none;\">"+this.atLink(this.emoji(e))+"</li>"):"<li>"+this.atLink(this.emoji(e))+"</li>"},e},j.markdownToCRenderer=function(o,r,e,t){var n="",s=0,d=this.classPrefix;t=t||1;for(var g=0,u=o.length;u>g;g++){var f=o[g].text,l=o[g].level;t>l||(n+=l>s?"":s>l?Array(s-l+2).join("</ul></li>"):"</ul></li>",n+="<li><a class=\"toc-level-"+l+"\" href=\"#"+f+"\" level=\""+l+"\">"+f+"</a><ul>",s=l)}var c=r.find(".markdown-toc");if(1>c.length&&"false"===r.attr("previewContainer")){var w="<div class=\"markdown-toc "+d+"markdown-toc\"></div>";w=e?"<div class=\""+d+"toc-menu\">"+w+"</div>":w,r.html(w),c=r.find(".markdown-toc")}return e&&c.wrap("<div class=\""+d+"toc-menu\"></div><br/>"),c.html("<ul class=\"markdown-toc-list\"></ul>").children(".markdown-toc-list").html(n.replace(/\r?\n?\<ul\>\<\/ul\>/g,"")),c},j.tocDropdownMenu=function(o,l){l=l||"Table of Contents";var e=400,i=o.find("."+this.classPrefix+"toc-menu");return i.each(function(){var t=v(this),n=t.children(".markdown-toc"),o="<a href=\"javascript:;\" class=\"toc-menu-btn\"><i class=\"fa fa-angle-down\"></i>"+l+"</a>",i=n.children("ul"),a=i.find("li");n.append(o),a.first().before("<li><h1>"+l+" <i class=\"fa fa-angle-down\"></i></h1></li>"),t.mouseover(function(){i.show(),a.each(function(){var t=v(this),a=t.children("ul");if(""===a.html()&&a.remove(),0<a.length&&""!==a.html()){var o=t.children("a").first();1>o.children(".fa").length&&o.append(v("<i class=\"fa fa-angle-down\"></i>").css({float:"right",paddingTop:"4px"}))}t.mouseover(function(){a.css("z-index",e).show(),e+=1}).mouseleave(function(){a.hide()})})}).mouseleave(function(){i.hide()})}),i},j.filterHTMLTags=function(t,a){if("string"!=typeof t&&(t=new String(t)),"string"!=typeof a)return t;for(var l,d=a.split("|"),c=d[0].split(","),h=d[1],o=0,g=c.length;g>o;o++)l=c[o],t=t.replace(new RegExp("<s*"+l+"s*([^>]*)>([^>]*)<s*/"+l+"s*>","igm"),"");if("undefined"!=typeof h){var n=/\<(\w+)\s*([^\>]*)\>([^\>]*)\<\/(\w+)\>/gi;t="*"===h?t.replace(n,function(r,a,e,t,i){return"<"+a+">"+t+"</"+i+">"}):"on*"===h?t.replace(n,function(d,e,t,i,o){var r=v("<"+e+">"+i+"</"+o+">"),n=v(d)[0].attributes,a={};v.each(n,function(t,o){"\""!==o.nodeName&&(a[o.nodeName]=o.nodeValue)}),v.each(a,function(e){0===e.indexOf("on")&&delete a[e]}),r.attr(a);var s="undefined"==typeof r[1]?"":v(r[1]).text();return r[0].outerHTML+s}):t.replace(n,function(l,e,t,i){var o=h.split(","),r=v(l);return r.html(i),v.each(o,function(e){r.attr(o[e],null)}),r[0].outerHTML})}return t},j.markdownToHTML=function(l,e){j.$marked=marked;var t=v("#"+l),o=t.settings=v.extend(!0,{gfm:!0,toc:!0,tocm:!1,tocStartLevel:1,tocTitle:"\u76EE\u5F55",tocDropdown:!1,tocContainer:"",markdown:"",markdownSourceCode:!1,htmlDecode:!1,autoLoadKaTeX:!0,pageBreak:!0,atLink:!0,emailLink:!0,tex:!1,taskList:!1,emoji:!1,flowChart:!1,sequenceDiagram:!1,previewCodeHighlight:!0},e||{}),i=t.find("textarea");1>i.length&&(t.append("<textarea></textarea>"),i=t.find("textarea"));var s=""===o.markdown?i.val():o.markdown,g=[],n={toc:o.toc,tocm:o.tocm,tocStartLevel:o.tocStartLevel,taskList:o.taskList,emoji:o.emoji,tex:o.tex,pageBreak:o.pageBreak,atLink:o.atLink,emailLink:o.emailLink,flowChart:o.flowChart,sequenceDiagram:o.sequenceDiagram,previewCodeHighlight:o.previewCodeHighlight},c={renderer:j.markedRenderer(g,n),gfm:o.gfm,tables:!0,breaks:!0,pedantic:!1,sanitize:!o.htmlDecode,smartLists:!0,smartypants:!0};s=new String(s);var h=marked(s,c);h=j.filterHTMLTags(h,o.htmlDecode),o.markdownSourceCode?i.text(s):i.remove(),t.addClass("markdown-body "+this.classPrefix+"html-preview").append(h);var u=""===o.tocContainer?t:v(o.tocContainer);if(""!==o.tocContainer&&u.attr("previewContainer",!1),o.toc&&(t.tocContainer=this.markdownToCRenderer(g,u,o.tocDropdown,o.tocStartLevel),(o.tocDropdown||0<t.find("."+this.classPrefix+"toc-menu").length)&&this.tocDropdownMenu(t,o.tocTitle),""!==o.tocContainer&&t.find(".editormd-toc-menu, .editormd-markdown-toc").remove()),o.previewCodeHighlight&&(t.find("pre").addClass("prettyprint linenums"),prettyPrint()),j.isIE8||(o.flowChart&&t.find(".flowchart").flowChart(),o.sequenceDiagram&&t.find(".sequence-diagram").sequenceDiagram({theme:"simple"})),o.tex){var m=function(){t.find("."+j.classNames.tex).each(function(){var t=v(this);katex.render(t.html().replace(/&lt;/g,"<").replace(/&gt;/g,">"),t[0]),t.find(".katex").css("font-size","1.6em")})};!o.autoLoadKaTeX||j.$katex||j.kaTeXLoaded?m():this.loadKaTeX(function(){j.$katex=katex,j.kaTeXLoaded=!0,m()})}return t.getMarkdown=function(){return i.val()},t},j.themes=["default","dark"],j.previewThemes=["default","dark"],j.editorThemes=["default","3024-day","3024-night","ambiance","ambiance-mobile","base16-dark","base16-light","blackboard","cobalt","eclipse","elegant","erlang-dark","lesser-dark","mbo","mdn-like","midnight","monokai","neat","neo","night","paraiso-dark","paraiso-light","pastel-on-dark","rubyblue","solarized","the-matrix","tomorrow-night-eighties","twilight","vibrant-ink","xq-dark","xq-light"],j.loadPlugins={},j.loadFiles={js:[],css:[],plugin:[]},j.loadPlugin=function(o,t,i){t=t||function(){},this.loadScript(o,function(){j.loadFiles.plugin.push(o),t()},i)},j.loadCSS=function(o,t,i){i=i||"head",t=t||function(){};var r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.onload=r.onreadystatechange=function(){j.loadFiles.css.push(o),t()},r.href=o+".css","head"===i?document.getElementsByTagName("head")[0].appendChild(r):document.body.appendChild(r)},j.isIE="Microsoft Internet Explorer"==navigator.appName,j.isIE8=j.isIE&&"8."==navigator.appVersion.match(/8./i),j.loadScript=function(o,t,i){i=i||"head",t=t||function(){};var r=null;r=document.createElement("script"),r.id=o.replace(/[\./]+/g,"-"),r.type="text/javascript",r.src=o+".js",j.isIE8?r.onreadystatechange=function(){r.readyState&&("loaded"===r.readyState||"complete"===r.readyState)&&(r.onreadystatechange=null,j.loadFiles.js.push(o),t())}:r.onload=function(){j.loadFiles.js.push(o),t()},"head"===i?document.getElementsByTagName("head")[0].appendChild(r):document.body.appendChild(r)},j.katexURL={css:USECDN?"//cdn.bootcss.com/KaTeX/0.11.1/katex.min":"/static/editor.md/katex/katex.min",js:USECDN?"//cdn.bootcss.com/KaTeX/0.11.1/katex.min":"/static/editor.md/katex/katex.min"},j.kaTeXLoaded=!1,j.loadKaTeX=function(e){j.loadCSS(j.katexURL.css,function(){j.loadScript(j.katexURL.js,e||function(){})})},j.lockScreen=function(t){v("html,body").css("overflow",t?"hidden":"")},j.createDialog=function(h){h=v.extend(!0,{name:"",width:420,height:240,title:"",drag:!0,closed:!0,content:"",mask:!0,maskStyle:{backgroundColor:"#fff",opacity:.1},lockScreen:!0,footer:!0,buttons:!1},h);var w=this,o=this.editor,i=j.classPrefix,t=new Date().getTime(),a=""===h.name?i+"dialog-"+t:h.name,r=j.mouseOrTouch,l="<div class=\""+i+"dialog "+a+"\">";""!==h.title&&(l+="<div class=\""+i+"dialog-header\""+(h.drag?" style=\"cursor: move;\"":"")+">",l+="<strong class=\""+i+"dialog-title\">"+h.title+"</strong>",l+="</div>"),h.closed&&(l+="<a href=\"javascript:;\" class=\"fa fa-close "+i+"dialog-close\"></a>"),l+="<div class=\""+i+"dialog-container\">"+h.content,(h.footer||"string"==typeof h.footer)&&(l+="<div class=\""+i+"dialog-footer\">"+("boolean"==typeof h.footer?"":h.footer)+"</div>"),l+="</div>",l+="<div class=\""+i+"dialog-mask "+i+"dialog-mask-bg\"></div>",l+="<div class=\""+i+"dialog-mask "+i+"dialog-mask-con\"></div>",l+="</div>",o.append(l);var n=o.find("."+a);n.lockScreen=function(e){return h.lockScreen&&(v("html,body").css("overflow",e?"hidden":""),w.resize()),n},n.showMask=function(){return h.mask&&o.find("."+i+"mask").css(h.maskStyle).css("z-index",j.dialogZindex-1).show(),n},n.hideMask=function(){return h.mask&&o.find("."+i+"mask").hide(),n},n.loading=function(t){var o=n.find("."+i+"dialog-mask");return o[t?"show":"hide"](),n},n.lockScreen(!0).showMask(),n.show().css({zIndex:j.dialogZindex,border:j.isIE8?"1px solid #ddd":"",width:"number"==typeof h.width?h.width+"px":h.width,height:"number"==typeof h.height?h.height+"px":h.height});var c=function(){n.css({top:(v(window).height()-n.height())/2+"px",left:(v(window).width()-n.width())/2+"px"})};if(c(),v(window).resize(c),n.children("."+i+"dialog-close").bind(r("click","touchend"),function(){n.hide().lockScreen(!1).hideMask()}),"object"==typeof h.buttons){var d=n.footer=n.find("."+i+"dialog-footer");for(var u in h.buttons){var f=h.buttons[u],g=i+u+"-btn";d.append("<button class=\""+i+"btn "+g+"\">"+f[0]+"</button>"),f[1]=v.proxy(f[1],n),d.children("."+g).bind(r("click","touchend"),f[1])}}if(""!==h.title&&h.drag){var p,C,y=n.children("."+i+"dialog-header");h.mask||y.bind(r("click","touchend"),function(){j.dialogZindex+=2,n.css("z-index",j.dialogZindex)}),y.mousedown(function(e){e=e||window.event,p=e.clientX-parseInt(n[0].style.left),C=e.clientY-parseInt(n[0].style.top),document.onmousemove=b});var S=function(e){e.removeClass(i+"user-unselect").off("selectstart")},k=function(e){e.addClass(i+"user-unselect").on("selectstart",function(){return!1})},b=function(t){t=t||window.event;var o,i,d=parseInt(n[0].style.left),s=parseInt(n[0].style.top);0<=d?d+n.width()<=v(window).width()?o=t.clientX-p:(o=v(window).width()-n.width(),document.onmousemove=null):(o=0,document.onmousemove=null),0<=s?i=t.clientY-C:(i=0,document.onmousemove=null),document.onselectstart=function(){return!1},k(v("body")),k(n),n[0].style.left=o+"px",n[0].style.top=i+"px"};document.onmouseup=function(){S(v("body")),S(n),document.onselectstart=null,document.onmousemove=null},y.touchDraggable=function(){var a=null,t=function(e){e.preventDefault();var t=e.originalEvent;v(this).parent().css({top:t.changedTouches[0].pageY-a.y,left:t.changedTouches[0].pageX-a.x})};this.bind("touchstart",function(e){var t=e.originalEvent,i=v(this).parent().position();a={x:t.changedTouches[0].pageX-i.left,y:t.changedTouches[0].pageY-i.top}}).bind("touchmove",t)},y.touchDraggable()}return j.dialogZindex+=2,n},j.mouseOrTouch=function(e,t){e=e||"click",t=t||"touchend";var i=e;try{document.createEvent("TouchEvent"),i=t}catch(t){}return i},j.dateFormat=function(e){e=e||"";var p=function(e){return 10>e?"0"+e:e},u=new Date,t=u.getFullYear(),i=t.toString().slice(2,4),o=p(u.getMonth()+1),r=p(u.getDate()),n=u.getDay(),a=p(u.getHours()),s=p(u.getMinutes()),l=p(u.getSeconds()),c=p(u.getMilliseconds()),h="",f=t+"-"+o+"-"+r,w=a+":"+s+":"+l;switch(e){case"UNIX Time":h=u.getTime();break;case"UTC":h=u.toUTCString();break;case"yy":h=i;break;case"year":case"yyyy":h=t;break;case"month":case"mm":h=o;break;case"cn-week-day":case"cn-wd":h="\u661F\u671F"+["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"][n];break;case"week-day":case"wd":h=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][n];break;case"day":case"dd":h=r;break;case"hour":case"hh":h=a;break;case"min":case"ii":h=s;break;case"second":case"ss":h=l;break;case"ms":h=c;break;case"yy-mm-dd":h=i+"-"+o+"-"+r;break;case"yyyy-mm-dd":h=f;break;case"yyyy-mm-dd h:i:s ms":case"full + ms":h=f+" "+w+" "+c;break;case"full":case"yyyy-mm-dd h:i:s":default:h=f+" "+w;}return h},j}});