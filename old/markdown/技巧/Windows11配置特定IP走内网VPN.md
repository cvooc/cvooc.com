最后更新时间: 2022年1月22日 02:09:45

# Windows11配置特定IP走内网VPN

## 说明

在日常开发中,我们偶尔需要到VPN来访问一些企业内网的服务,如接口/数据库.
但是有个问题是在启用VPN后,所有的请求都会默认走VPN网关,造成在使用VPN的同时我们无法连接外网的问题.这点还是很难受的,毕竟我们同时可能还需要上百度查询资料.

而且我们使用内网VPN时,可能只是用来访问特定几组IP,比如数据库,为此为此放弃了整片森林我肯定是忍不了的.

**所以我整理了下,配置只有特定IP走VPN网关的方式,我使用的是`Windows11`所以演示界面可能不一样,但是`Windows10`和之前的系统版本应该都是兼容的.**

## 步骤

我默认此时配置好了VPN,并且可以正常使用,本篇文章主要用来记录解决后面的问题.

### 0.配置前的准备工作

> 首先正常连接VPN,不然因为VPN没有启动,在`网络和共享中心`里是不显示VPN的.

进入`控制面板`->`网络和共享中心`->找到VPN的名字并点击,记录下弹出框里的`客户端IPv4地址`,这个后面会用到,然后就可以把VPN断开了.

![0.png](./static/img/Windows11配置特定IP走内网VPN/0.png)

### 1.关闭VPN默认代理配置

由于配置藏得比较深,我尽量把图截全一点

进入`控制面板`->`internet选项`->`连接`,这里能看到之前配置的VPN选项,选中要配置的那个VPN后,点击设置

![1.png](./static/img/Windows11配置特定IP走内网VPN/1.png)

点击弹出框`属性`->`网络`->`internet协议版本4`->`属性`

![2.png](./static/img/Windows11配置特定IP走内网VPN/2.png)

> 这些页面一定要点击`确定`来关闭,不然修改没保存不会生效.

点击弹出框`高级`->把`在远程网络上使用默认网关`去掉,如图->点击`确定`关闭弹出框.

选择`使用下面的IP地址`,在`绿框`内输入前面记下来来的地址->点击`确定`关闭弹窗框.

挨个点击`确定`关闭之前打开的所有窗口.

![3.png](./static/img/Windows11配置特定IP走内网VPN/3.png)

### 2.手动添加需要访问VPN的IP

在`开始菜单`上右键,点击`Windosw终端(管理员)`或者`命令提示符(管理员)`

![4.png](./static/img/Windows11配置特定IP走内网VPN/4.png)

在弹窗窗口里输入下列命令并回车

```
route ADD 你之前连上VPN后需要使用的服务的IP地址 MASK 255.255.255.0 前面记录下来配置的IP地址
```

例如:

```
// 这是示例,不要直接复制
route ADD 192.168.0.244 MASK 255.255.255.0 192.168.1.21
```

![5.png](./static/img/Windows11配置特定IP走内网VPN/5.png)

> 注意,这个手动操作路由只对本次修改有效,每次重启电脑都需要重新执行下命令.如果你嫌麻烦的话,可以 在命令中加上`-p`就可以永久生效了.如下:

```
route -p ADD 192.168.0.244 MASK 255.255.255.0 192.168.1.21
```

至此配置完成,现在可以启动VPN测试下了.

## 后续

### 删除上面配置的IP

执行下面的命令即可

```
route delete 你之前连上VPN后需要使用的服务的IP地址 前面记录下来配置的IP地址
```

例如:

```
route delete 192.168.0.244 192.168.1.21
```